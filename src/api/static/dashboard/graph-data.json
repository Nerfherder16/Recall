{
  "nodes": [
    { "id": "core/config", "label": "config.py", "type": "core", "description": "Settings + get_settings() singleton; all service URLs/thresholds" },
    { "id": "core/models", "label": "models.py", "type": "core", "description": "All Pydantic models: Memory, Session, MemoryQuery, DetectedSignal, enums" },
    { "id": "core/embeddings", "label": "embeddings.py", "type": "core", "description": "EmbeddingService — Ollama embed, LRU cache (200 entries), content_hash()" },
    { "id": "core/llm", "label": "llm.py", "type": "core", "description": "OllamaLLM — generate() calls, think:false for qwen3" },
    { "id": "core/metrics", "label": "metrics.py", "type": "core", "description": "MetricsCollector — Prometheus counters/histograms/gauges" },
    { "id": "core/domains", "label": "domains.py", "type": "core", "description": "CANONICAL_DOMAINS, DOMAIN_ALIASES, normalize_domain()" },
    { "id": "core/retrieval", "label": "retrieval.py", "type": "core", "description": "RetrievalPipeline — 8-stage retrieval with ML reranking" },
    { "id": "core/signal_detector", "label": "signal_detector.py", "type": "core", "description": "SignalDetector — LLM-based conversation analysis" },
    { "id": "core/signal_classifier", "label": "signal_classifier.py", "type": "core", "description": "ML pre-filter: TF-IDF + logistic regression (pure-math)" },
    { "id": "core/signal_trainer", "label": "signal_classifier_trainer.py", "type": "core", "description": "Trains signal classifier from corpus + audit_log" },
    { "id": "core/reranker", "label": "reranker.py", "type": "core", "description": "ML reranker: 11-feature logistic regression (pure-math)" },
    { "id": "core/reranker_trainer", "label": "reranker_trainer.py", "type": "core", "description": "Trains reranker from Postgres feedback entries" },
    { "id": "core/consolidation", "label": "consolidation.py", "type": "core", "description": "MemoryConsolidator — similarity clustering + LLM merge" },
    { "id": "core/auto_linker", "label": "auto_linker.py", "type": "core", "description": "auto_link_memory() — top-3 similar → RELATED_TO edges" },
    { "id": "core/health", "label": "health.py", "type": "core", "description": "HealthComputer — parallel aggregation of all 4 stores" },
    { "id": "core/document_ingest", "label": "document_ingest.py", "type": "core", "description": "PDF/markdown/text parsing, chunking, LLM extraction" },
    { "id": "core/diff_parser", "label": "diff_parser.py", "type": "core", "description": "extract_values() — regex extraction from git diffs" },

    { "id": "storage/qdrant", "label": "qdrant.py", "type": "storage", "description": "QdrantStore — vector CRUD (3 collections), search(), scroll_all()" },
    { "id": "storage/neo4j", "label": "neo4j_store.py", "type": "storage", "description": "Neo4jStore — graph CRUD, relationships, contradictions" },
    { "id": "storage/neo4j_docs", "label": "neo4j_documents.py", "type": "storage", "description": "Neo4jDocumentStore — Document nodes, EXTRACTED_FROM edges" },
    { "id": "storage/redis", "label": "redis_store.py", "type": "storage", "description": "RedisStore — sessions, turns, pending signals, ML weight cache" },
    { "id": "storage/postgres", "label": "postgres_store.py", "type": "storage", "description": "PostgresStore — audit_log, session_archive, users" },

    { "id": "api/main", "label": "main.py", "type": "api", "description": "FastAPI app, lifespan, router mounts, CORS, rate limiting" },
    { "id": "api/auth", "label": "auth.py", "type": "api", "description": "require_auth() — Bearer token resolution" },
    { "id": "routes/ingest", "label": "ingest.py", "type": "api", "description": "POST /ingest/turns, signal approve/reject" },
    { "id": "routes/memory", "label": "memory.py", "type": "api", "description": "POST /memory, GET/DELETE, pin, feedback, batch, anti-patterns" },
    { "id": "routes/search", "label": "search.py", "type": "api", "description": "POST /search/query, GET /search/browse, timeline, similar" },
    { "id": "routes/session", "label": "session.py", "type": "api", "description": "POST /session/start|end, GET /session/{id}" },
    { "id": "routes/observe", "label": "observe.py", "type": "api", "description": "POST /observe/file-change, git-diff, session-snapshot" },
    { "id": "routes/admin", "label": "admin.py", "type": "api", "description": "consolidate, decay, ML retrain, users, domains, graph bootstrap" },
    { "id": "routes/health_dash", "label": "health_dashboard.py", "type": "api", "description": "GET /admin/health/dashboard, forces, conflicts" },
    { "id": "routes/documents", "label": "documents.py", "type": "api", "description": "POST /documents/ingest, CRUD, pin/unpin, cascade" },
    { "id": "routes/events", "label": "events.py", "type": "api", "description": "GET /events/stream (SSE) — live health updates" },
    { "id": "routes/ops", "label": "ops.py", "type": "api", "description": "GET /admin/export, POST /admin/import, reconcile" },

    { "id": "workers/main", "label": "workers/main.py", "type": "worker", "description": "ARQ WorkerSettings — cron jobs: decay, consolidation, patterns" },
    { "id": "workers/signals", "label": "signals.py", "type": "worker", "description": "process_signal_detection() — ML pre-filter → LLM → store/queue" },
    { "id": "workers/decay", "label": "decay.py", "type": "worker", "description": "DecayWorker — scroll Qdrant, compute decay, archive low-importance" },
    { "id": "workers/patterns", "label": "patterns.py", "type": "worker", "description": "PatternExtractor — cluster episodic → promote semantic" },
    { "id": "workers/observer", "label": "observer.py", "type": "worker", "description": "LLM fact extraction from file edits → memory storage" },
    { "id": "workers/facts", "label": "fact_extractor.py", "type": "worker", "description": "LLM atomic fact extraction → sub-embeddings" },
    { "id": "workers/invalidation", "label": "invalidation.py", "type": "worker", "description": "check_invalidations() — regex diff match → flag stale" },

    { "id": "dash/overview", "label": "DashboardPage", "type": "dashboard", "description": "Overview: health, stats, domain stats, Ollama, SSE" },
    { "id": "dash/memories", "label": "MemoriesPage", "type": "dashboard", "description": "Browse/search, grid/list, pin, bulk delete, detail modal" },
    { "id": "dash/sessions", "label": "SessionsPage", "type": "dashboard", "description": "Session list with expandable turns" },
    { "id": "dash/signals", "label": "SignalsPage", "type": "dashboard", "description": "Pending signals by session, approve/reject" },
    { "id": "dash/audit", "label": "AuditPage", "type": "dashboard", "description": "Audit log with filters" },
    { "id": "dash/health", "label": "HealthPage", "type": "dashboard", "description": "Health metrics, conflicts, stale audit" },
    { "id": "dash/documents", "label": "DocumentsPage", "type": "dashboard", "description": "Document upload, list, pin/unpin, delete" },
    { "id": "dash/anti_patterns", "label": "AntiPatternsPage", "type": "dashboard", "description": "Anti-pattern CRUD" },
    { "id": "dash/users", "label": "UsersPage", "type": "dashboard", "description": "User management, API key creation" },
    { "id": "dash/settings", "label": "SettingsPage", "type": "dashboard", "description": "Maintenance ops, ML status, theme" },

    { "id": "hook/retrieve", "label": "recall-retrieve.js", "type": "hook", "description": "UserPromptSubmit — queries /search/browse, injects top 5" },
    { "id": "hook/observe", "label": "observe-edit.js", "type": "hook", "description": "PostToolUse — extracts facts from file edits" },
    { "id": "hook/summary", "label": "session-summary.js", "type": "hook", "description": "Stop — stores episodic session summary" },
    { "id": "hook/git_watch", "label": "git-watch.js", "type": "hook", "description": "PostToolUse — diffs → invalidation check" }
  ],
  "links": [
    { "source": "core/embeddings", "target": "core/config", "type": "imports" },
    { "source": "core/embeddings", "target": "core/metrics", "type": "imports" },
    { "source": "core/llm", "target": "core/config", "type": "imports" },
    { "source": "core/llm", "target": "core/metrics", "type": "imports" },
    { "source": "core/retrieval", "target": "core/config", "type": "imports" },
    { "source": "core/retrieval", "target": "core/embeddings", "type": "calls" },
    { "source": "core/retrieval", "target": "core/models", "type": "imports" },
    { "source": "core/retrieval", "target": "core/reranker", "type": "calls" },
    { "source": "core/retrieval", "target": "storage/qdrant", "type": "calls" },
    { "source": "core/retrieval", "target": "storage/neo4j", "type": "calls" },
    { "source": "core/retrieval", "target": "storage/redis", "type": "calls" },
    { "source": "core/signal_detector", "target": "core/config", "type": "imports" },
    { "source": "core/signal_detector", "target": "core/llm", "type": "calls" },
    { "source": "core/signal_detector", "target": "core/models", "type": "imports" },
    { "source": "core/signal_detector", "target": "core/domains", "type": "imports" },
    { "source": "core/signal_classifier", "target": "core/reranker", "type": "imports" },
    { "source": "core/signal_trainer", "target": "core/signal_classifier", "type": "imports" },
    { "source": "core/reranker", "target": "core/models", "type": "imports" },
    { "source": "core/reranker_trainer", "target": "core/reranker", "type": "imports" },
    { "source": "core/consolidation", "target": "core/config", "type": "imports" },
    { "source": "core/consolidation", "target": "core/embeddings", "type": "calls" },
    { "source": "core/consolidation", "target": "core/llm", "type": "calls" },
    { "source": "core/consolidation", "target": "core/models", "type": "imports" },
    { "source": "core/auto_linker", "target": "storage/qdrant", "type": "calls" },
    { "source": "core/auto_linker", "target": "storage/neo4j", "type": "calls" },
    { "source": "core/health", "target": "core/config", "type": "imports" },
    { "source": "core/health", "target": "storage/qdrant", "type": "calls" },
    { "source": "core/health", "target": "storage/neo4j", "type": "calls" },
    { "source": "core/health", "target": "storage/redis", "type": "calls" },
    { "source": "core/health", "target": "storage/postgres", "type": "calls" },
    { "source": "core/document_ingest", "target": "core/embeddings", "type": "calls" },
    { "source": "core/document_ingest", "target": "core/llm", "type": "calls" },
    { "source": "core/document_ingest", "target": "core/models", "type": "imports" },

    { "source": "storage/qdrant", "target": "core/models", "type": "imports" },
    { "source": "storage/qdrant", "target": "core/config", "type": "imports" },
    { "source": "storage/neo4j", "target": "core/models", "type": "imports" },
    { "source": "storage/neo4j", "target": "core/config", "type": "imports" },
    { "source": "storage/neo4j_docs", "target": "core/models", "type": "imports" },
    { "source": "storage/redis", "target": "core/models", "type": "imports" },
    { "source": "storage/redis", "target": "core/config", "type": "imports" },
    { "source": "storage/postgres", "target": "core/config", "type": "imports" },

    { "source": "api/main", "target": "core/config", "type": "imports" },
    { "source": "api/main", "target": "core/metrics", "type": "imports" },
    { "source": "api/main", "target": "storage/qdrant", "type": "calls" },
    { "source": "api/main", "target": "storage/neo4j", "type": "calls" },
    { "source": "api/main", "target": "storage/redis", "type": "calls" },
    { "source": "api/main", "target": "storage/postgres", "type": "calls" },
    { "source": "api/auth", "target": "core/config", "type": "imports" },
    { "source": "api/auth", "target": "storage/postgres", "type": "calls" },

    { "source": "routes/ingest", "target": "core/embeddings", "type": "calls" },
    { "source": "routes/ingest", "target": "core/signal_detector", "type": "imports" },
    { "source": "routes/ingest", "target": "core/models", "type": "imports" },
    { "source": "routes/ingest", "target": "storage/qdrant", "type": "calls" },
    { "source": "routes/ingest", "target": "storage/neo4j", "type": "calls" },
    { "source": "routes/ingest", "target": "storage/redis", "type": "calls" },
    { "source": "routes/ingest", "target": "workers/signals", "type": "triggers" },

    { "source": "routes/memory", "target": "core/embeddings", "type": "calls" },
    { "source": "routes/memory", "target": "core/domains", "type": "imports" },
    { "source": "routes/memory", "target": "core/models", "type": "imports" },
    { "source": "routes/memory", "target": "storage/qdrant", "type": "calls" },
    { "source": "routes/memory", "target": "storage/neo4j", "type": "calls" },
    { "source": "routes/memory", "target": "storage/redis", "type": "calls" },
    { "source": "routes/memory", "target": "storage/postgres", "type": "calls" },
    { "source": "routes/memory", "target": "api/auth", "type": "imports" },
    { "source": "routes/memory", "target": "workers/facts", "type": "triggers" },
    { "source": "routes/memory", "target": "core/auto_linker", "type": "triggers" },

    { "source": "routes/search", "target": "core/retrieval", "type": "calls" },
    { "source": "routes/search", "target": "core/models", "type": "imports" },
    { "source": "routes/search", "target": "core/embeddings", "type": "imports" },

    { "source": "routes/session", "target": "core/models", "type": "imports" },
    { "source": "routes/session", "target": "storage/redis", "type": "calls" },
    { "source": "routes/session", "target": "storage/postgres", "type": "calls" },

    { "source": "routes/observe", "target": "workers/observer", "type": "triggers" },
    { "source": "routes/observe", "target": "core/diff_parser", "type": "imports" },
    { "source": "routes/observe", "target": "workers/invalidation", "type": "triggers" },

    { "source": "routes/admin", "target": "core/consolidation", "type": "calls" },
    { "source": "routes/admin", "target": "core/domains", "type": "imports" },
    { "source": "routes/admin", "target": "core/embeddings", "type": "calls" },
    { "source": "routes/admin", "target": "core/models", "type": "imports" },
    { "source": "routes/admin", "target": "workers/decay", "type": "calls" },
    { "source": "routes/admin", "target": "storage/qdrant", "type": "calls" },
    { "source": "routes/admin", "target": "storage/neo4j", "type": "calls" },
    { "source": "routes/admin", "target": "storage/redis", "type": "calls" },
    { "source": "routes/admin", "target": "storage/postgres", "type": "calls" },

    { "source": "routes/health_dash", "target": "core/health", "type": "calls" },
    { "source": "routes/health_dash", "target": "storage/redis", "type": "calls" },

    { "source": "routes/documents", "target": "core/document_ingest", "type": "calls" },
    { "source": "routes/documents", "target": "core/models", "type": "imports" },
    { "source": "routes/documents", "target": "storage/qdrant", "type": "calls" },
    { "source": "routes/documents", "target": "storage/neo4j", "type": "calls" },
    { "source": "routes/documents", "target": "storage/neo4j_docs", "type": "calls" },
    { "source": "routes/documents", "target": "storage/postgres", "type": "calls" },
    { "source": "routes/documents", "target": "api/auth", "type": "imports" },

    { "source": "routes/events", "target": "storage/qdrant", "type": "calls" },
    { "source": "routes/events", "target": "storage/neo4j", "type": "calls" },
    { "source": "routes/events", "target": "storage/redis", "type": "calls" },
    { "source": "routes/events", "target": "storage/postgres", "type": "calls" },

    { "source": "routes/ops", "target": "core/embeddings", "type": "calls" },
    { "source": "routes/ops", "target": "core/models", "type": "imports" },
    { "source": "routes/ops", "target": "storage/qdrant", "type": "calls" },
    { "source": "routes/ops", "target": "storage/neo4j", "type": "calls" },
    { "source": "routes/ops", "target": "storage/postgres", "type": "calls" },

    { "source": "workers/main", "target": "core/config", "type": "imports" },
    { "source": "workers/main", "target": "core/metrics", "type": "imports" },
    { "source": "workers/main", "target": "workers/decay", "type": "calls" },
    { "source": "workers/main", "target": "workers/patterns", "type": "calls" },
    { "source": "workers/main", "target": "core/consolidation", "type": "calls" },
    { "source": "workers/main", "target": "core/signal_trainer", "type": "calls" },
    { "source": "workers/main", "target": "core/reranker_trainer", "type": "calls" },
    { "source": "workers/main", "target": "storage/qdrant", "type": "calls" },
    { "source": "workers/main", "target": "storage/neo4j", "type": "calls" },
    { "source": "workers/main", "target": "storage/redis", "type": "calls" },
    { "source": "workers/main", "target": "storage/postgres", "type": "calls" },

    { "source": "workers/signals", "target": "core/signal_detector", "type": "calls" },
    { "source": "workers/signals", "target": "core/signal_classifier", "type": "calls" },
    { "source": "workers/signals", "target": "core/embeddings", "type": "calls" },
    { "source": "workers/signals", "target": "core/models", "type": "imports" },
    { "source": "workers/signals", "target": "core/metrics", "type": "imports" },
    { "source": "workers/signals", "target": "storage/qdrant", "type": "calls" },
    { "source": "workers/signals", "target": "storage/neo4j", "type": "calls" },
    { "source": "workers/signals", "target": "storage/redis", "type": "calls" },
    { "source": "workers/signals", "target": "storage/postgres", "type": "calls" },

    { "source": "workers/decay", "target": "core/config", "type": "imports" },
    { "source": "workers/decay", "target": "storage/qdrant", "type": "calls" },

    { "source": "workers/patterns", "target": "core/embeddings", "type": "calls" },
    { "source": "workers/patterns", "target": "core/llm", "type": "calls" },
    { "source": "workers/patterns", "target": "core/models", "type": "imports" },
    { "source": "workers/patterns", "target": "storage/qdrant", "type": "calls" },
    { "source": "workers/patterns", "target": "storage/neo4j", "type": "calls" },

    { "source": "workers/observer", "target": "core/embeddings", "type": "calls" },
    { "source": "workers/observer", "target": "core/llm", "type": "calls" },
    { "source": "workers/observer", "target": "core/domains", "type": "imports" },
    { "source": "workers/observer", "target": "core/models", "type": "imports" },
    { "source": "workers/observer", "target": "storage/qdrant", "type": "calls" },
    { "source": "workers/observer", "target": "storage/neo4j", "type": "calls" },
    { "source": "workers/observer", "target": "storage/postgres", "type": "calls" },

    { "source": "workers/facts", "target": "core/embeddings", "type": "calls" },
    { "source": "workers/facts", "target": "core/llm", "type": "calls" },
    { "source": "workers/facts", "target": "storage/qdrant", "type": "calls" },

    { "source": "workers/invalidation", "target": "storage/qdrant", "type": "calls" },
    { "source": "workers/invalidation", "target": "storage/postgres", "type": "calls" },

    { "source": "core/signal_classifier", "target": "storage/redis", "type": "data_flow" },
    { "source": "core/signal_trainer", "target": "storage/redis", "type": "data_flow" },
    { "source": "core/reranker", "target": "storage/redis", "type": "data_flow" },
    { "source": "core/reranker_trainer", "target": "storage/redis", "type": "data_flow" },
    { "source": "core/reranker_trainer", "target": "storage/postgres", "type": "data_flow" },
    { "source": "core/signal_trainer", "target": "storage/postgres", "type": "data_flow" },

    { "source": "dash/overview", "target": "routes/admin", "type": "data_flow" },
    { "source": "dash/overview", "target": "routes/events", "type": "data_flow" },
    { "source": "dash/memories", "target": "routes/search", "type": "data_flow" },
    { "source": "dash/memories", "target": "routes/memory", "type": "data_flow" },
    { "source": "dash/sessions", "target": "routes/session", "type": "data_flow" },
    { "source": "dash/sessions", "target": "routes/ingest", "type": "data_flow" },
    { "source": "dash/signals", "target": "routes/ingest", "type": "data_flow" },
    { "source": "dash/audit", "target": "routes/admin", "type": "data_flow" },
    { "source": "dash/health", "target": "routes/health_dash", "type": "data_flow" },
    { "source": "dash/documents", "target": "routes/documents", "type": "data_flow" },
    { "source": "dash/anti_patterns", "target": "routes/memory", "type": "data_flow" },
    { "source": "dash/users", "target": "routes/admin", "type": "data_flow" },
    { "source": "dash/settings", "target": "routes/admin", "type": "data_flow" },

    { "source": "hook/retrieve", "target": "routes/search", "type": "data_flow" },
    { "source": "hook/observe", "target": "routes/observe", "type": "data_flow" },
    { "source": "hook/summary", "target": "routes/observe", "type": "data_flow" },
    { "source": "hook/git_watch", "target": "routes/observe", "type": "data_flow" }
  ],
  "metadata": {
    "generated_at": "2026-02-19T08:30:00Z",
    "node_count": 55,
    "link_count": 131
  }
}
